{% extends "base.html" %}
{% block title %}Lista de Propiedades{% endblock %}
{% block content %}
<h1>Propiedades disponibles</h1>

<div id="ajax-info" style="
    display:none;
    margin: 15px 0;
    padding: 15px;
    background: #fafafa;
    border-left: 4px solid #00C5EE;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    border-radius: 4px;
    font-size: 0.9em;
    line-height: 1.4em;
"></div>

{% if propiedades %}
  <ul>
    {% for p in propiedades %}
        <li class="item-propiedad" data-id="{{ p.id }}" style="margin-bottom:10px;">
        <strong>{{ p.direccion }}</strong><br>
        {{ p.descripcion|truncatewords:12 }}<br>
        <em>Precio:</em> {{ p.precio }} €<br>
        <a href="{% url 'detalle_propiedad' p.id %}">Ver detalles</a>
      </li>
    {% endfor %}
  </ul>
{% else %}
  <p>No hay propiedades registradas.</p>
{% endif %}

<p><a href="{% url 'index' %}">← Volver al inicio</a></p>
{% endblock %}

{% block extra_js %}
<script>
$(function() {

    let propiedadMostrada = null; // Guarda la propiedad actual

    $('.item-propiedad').click(function() {
        
        let id = $(this).data('id');

        // Si hago clic en la MISMA propiedad → cerrar
        if (id === propiedadMostrada) {
            $('#ajax-info').fadeOut(300);
            propiedadMostrada = null;
            return;
        }

        // Hago clic en una propiedad diferente → actualizar
        $.get('/ajax/propiedad/' + id + '/', function(data) {

            $('#ajax-info').html(
                "<strong>Agente:</strong> " + data.agente + "<br>" +
                "<strong>Cliente:</strong> " + data.cliente + "<br>" +
                "<strong>Precio:</strong> " + data.precio + " €<br>" +
                "<strong>Descripción:</strong> " + data.descripcion + "<br>"
            );

            // Si está oculto, lo mostramos
            if (!$('#ajax-info').is(":visible")) {
                $('#ajax-info').fadeIn(300);
            }

            // Guardamos esta propiedad como la actual
            propiedadMostrada = id;
        });

    });

});
</script>
{% endblock %}
